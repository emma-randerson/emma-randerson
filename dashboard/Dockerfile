FROM rocker/tidyverse:4.0.3 as base

ARG REDSHIFT_IAM_ROLE
ARG REDSHIFT_HOST
ARG REDSHIFT_PORT
ARG REDSHIFT_USERNAME
ARG REDSHIFT_PASSWORD
ARG TENANT
ARG STAGE
ARG ENV
ARG GITHUB_TOKEN

ENV REDSHIFT_IAM_ROLE=$REDSHIFT_IAM_ROLE \
REDSHIFT_HOST=$REDSHIFT_HOST \
REDSHIFT_PORT=$REDSHIFT_PORT \
REDSHIFT_USERNAME=$REDSHIFT_USERNAME \
REDSHIFT_PASSWORD=$REDSHIFT_PASSWORD \
TENANT=$TENANT \
STAGE=$STAGE \
GITHUB_TOKEN=$GITHUB_TOKEN \
ENV=$ENV 

# install packages
COPY packages.R /tmp/packages.R
RUN Rscript /tmp/packages.R 

# default ip and port
COPY Rprofile.site /usr/lib/R/etc/
  
  # copy app
  COPY content /root/content